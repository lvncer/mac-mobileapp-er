# 概念設計図（日本語）

```mermaid
erDiagram
    会員 {
        会員ID
        氏名
        メールアドレス
        パスワードハッシュ
        郵便番号
        性別
        生年月日
        子供の人数
        末子の生年月日
        通知設定
        二段階認証設定
        作成日時
        更新日時
        削除フラグ
    }

    店舗 {
        店舗ID
        店舗名
        収容人数
        駐車場有無
        モバイルオーダー対応
        電話番号
        サービス情報
        作成日時
        更新日時
        削除フラグ
    }

    店舗営業時間 {
        営業時間ID
        店舗ID
        サービス種別
        開店時間
        閉店時間
        曜日
    }

    住所 {
        住所ID
        会員ID
        郵便番号
        都道府県市区町村
        詳細住所
        建物種別
        表札名
        建物外観
        会社名
        部署名
        配送メモ
        デフォルト設定
        作成日時
        更新日時
        削除フラグ
    }

    商品 {
        商品ID
        商品名
        説明
        基準価格
        カテゴリ
        画像URL
        販売可能フラグ
        作成日時
        更新日時
        削除フラグ
    }

    メニュー {
        メニューID
        メニュー名
        メニュー種別
        基準価格
        販売開始日
        販売終了日
        時間帯
        店内受取可能
        配達可能
        販売可能フラグ
        作成日時
        更新日時
        削除フラグ
    }

    メニュー構成 {
        メニュー構成ID
        メニューID
        商品ID
        数量
        置換可能フラグ
        置換カテゴリ
        追加料金
        作成日時
        更新日時
    }

    商品バリエーション {
        バリエーションID
        商品ID
        バリエーション名
        価格差分
        販売可能フラグ
        作成日時
        更新日時
    }

    店舗別価格加算 {
        店舗価格加算ID
        店舗ID
        メニューID
        価格加算額
        適用開始日時
        適用終了日時
        有効フラグ
        作成日時
        更新日時
    }

    クーポン {
        クーポンID
        クーポンコード
        クーポン名
        最大注文数量
        有効期限
        割引金額
        割引率
        有効フラグ
        作成日時
        更新日時
    }

    クーポン適用店舗 {
        クーポン店舗ID
        クーポンID
        店舗ID
    }

    クーポン適用商品 {
        クーポン商品ID
        クーポンID
        メニューID
        商品ID
    }

    お気に入り店舗 {
        お気に入りID
        会員ID
        店舗ID
        作成日時
    }

    注文 {
        注文ID
        会員ID
        店舗ID
        住所ID
        注文ステータス
        受取方法
        小計
        税額
        配送料
        割引額
        合計金額
        注文日時
        受取時間
        配達時間
        特別指示
        作成日時
        更新日時
    }

    注文詳細 {
        注文詳細ID
        注文ID
        商品ID
        メニューID
        数量
        単価
        合計価格
        注文時単価
        標準価格
        価格調整額
        調整理由
        置換商品フラグ
        カスタマイズ内容
        作成日時
        更新日時
    }

    注文クーポン {
        注文クーポンID
        注文ID
        クーポンID
        適用割引額
    }

    カート {
        カートID
        会員ID
        商品ID
        メニューID
        数量
        カスタマイズ内容
        作成日時
        更新日時
    }

    決済 {
        決済ID
        注文ID
        決済方法
        決済プロバイダ
        取引ID
        金額
        決済ステータス
        決済日時
        決済詳細情報
        作成日時
        更新日時
    }

    配送地域 {
        地域ID
        地域名
        郵便番号プレフィックス
        配送可能フラグ
        配送料
        配送時間
    }

    店舗配送地域 {
        店舗地域ID
        店舗ID
        地域ID
    }

    %% リレーションシップ
    会員 ||--o{ 住所 : ""
    会員 ||--o{ お気に入り店舗 : ""
    会員 ||--o{ 注文 : ""
    会員 ||--o{ カート : ""

    店舗 ||--o{ 店舗営業時間 : ""
    店舗 ||--o{ お気に入り店舗 : ""
    店舗 ||--o{ 注文 : ""
    店舗 ||--o{ クーポン適用店舗 : ""
    店舗 ||--o{ 店舗配送地域 : ""
    店舗 ||--o{ 店舗別価格加算 : ""

    商品 ||--o{ メニュー構成 : ""
    商品 ||--o{ 商品バリエーション : ""
    商品 ||--o{ 注文詳細 : ""
    商品 ||--o{ カート : ""

    メニュー ||--o{ メニュー構成 : ""
    メニュー ||--o{ クーポン適用商品 : ""
    メニュー ||--o{ 店舗別価格加算 : ""

    クーポン ||--o{ クーポン適用店舗 : ""
    クーポン ||--o{ クーポン適用商品 : ""
    クーポン ||--o{ 注文クーポン : ""

    注文 ||--o{ 注文詳細 : ""
    注文 ||--o{ 注文クーポン : ""
    注文 ||--|| 決済 : ""
    住所 ||--o{ 注文 : ""

    配送地域 ||--o{ 店舗配送地域 : ""
```

## エンティティ説明

### コアエンティティ

- **MEMBERS**: アプリ利用者（会員）
- **STORES**: マクドナルド店舗
- **ITEMS**: 基本商品（単品）
- **MENUS**: メニュー定義（単品・セット）
- **ORDERS**: 注文情報
- **ORDER_DETAILS**: 注文詳細（商品ごと）

### 支援エンティティ

- **ADDRESSES**: 配送先住所
- **CARTS**: ショッピングカート
- **PAYMENTS**: 決済情報
- **COUPONS**: クーポン・割引

### 関連エンティティ

- **STORE_HOURS**: 店舗営業時間
- **REGIONS**: 配送対応地域
- **FAVORITE_STORES**: お気に入り店舗

### 商品・価格管理エンティティ

- **MENU_ITEMS**: メニュー構成（セットの中身）
- **ITEM_VARIATIONS**: 商品バリエーション（サイズ等）
- **STORE_MENU_ADDITIONS**: 店舗別価格加算額

### 中間エンティティ

- **COUPON_STORES**: クーポン適用店舗
- **COUPON_MENUS**: クーポン適用商品
- **ORDER_COUPONS**: 注文で使用されたクーポン
- **STORE_REGIONS**: 店舗配送対応地域
